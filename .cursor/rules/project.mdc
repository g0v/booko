---
description: Project-wide conventions and architecture for TWb00ks
globs: "**/*"
---

# Project: 民主富二代補課小站 (TWb00ks)

Curated educational site for Taiwan's democratic history — tiered book lists, documentaries, community contributions. Deployed to booko.g0v.tw.

Tech stack: React 19 + TypeScript, Vite, Tailwind CSS (CDN), React Router DOM (HashRouter), Lucide React icons, Biome linter/formatter, Husky + lint-staged.

## Data Flow (SSOT)

Google Sheets → `npm run sync` → `books_data.ts` (auto-generated, git-ignored) → `constants.tsx` (typed re-exports) → components.

- Never edit `books_data.ts` directly.
- Never import from `books_data.ts` in components — always use `constants.tsx`.

## Naming Conventions

- Components: PascalCase `.tsx` (e.g. `BookCard.tsx`)
- Hooks: `use` prefix, camelCase `.ts` (e.g. `useTheme.ts`)
- Services: camelCase + `Service` suffix `.ts` (e.g. `geminiService.ts`)
- Utilities: camelCase `.ts` (e.g. `bookCover.ts`)
- Scripts: kebab-case `.js` Node ESM (e.g. `sync-data.js`)
- Constant exports: UPPER_SNAKE_CASE (e.g. `BOOKS`, `DOCUMENTARIES`)
- Interfaces/Types: PascalCase (e.g. `Book`, `ReadingLevel`)

Types live in a single `types.ts`. Constants live in a single `constants.tsx`.

## Code Quality

- Single Responsibility: each component does one thing. Views compose cards; cards don't fetch data.
- Open/Closed: add new views via new route + component; don't shoehorn into existing views.
- DRY: if the same block appears twice, extract it. Check reusable components first.
- Conciseness: no dead code, no commented-out blocks, no unused imports, no speculative abstractions.

## Reuse First

Before creating anything new, check existing:
- `BookCard` — book display with cover, tags, purchase dropdown, library link
- `DocCard` — documentary card with poster, metadata, YouTube search link
- `Layout` — page shell (header nav, main, footer), wraps all routes
- `ThemeToggle` — light/dark/system cycle button
- `useTheme` — theme state + localStorage persistence + system preference
- `getBookCoverUrl` — resolves cover: local path > books.com.tw sharding > fallback
- `getGeminiInsight` — Gemini API call, returns text

## Routing (HashRouter)

- `/` → BooksView (adult books by level)
- `/children` → ChildrenView (children & youth)
- `/documentaries` → DocumentariesView (grouped by tag)
- `/share` → ShareView (Google Form link)

To add a route: add to `App.tsx` Routes + add nav item in `Layout.tsx` `navItems`.

## Documentation Maintenance

After completing any feature:
1. Check README.md **待辦事項 / Todo List** — mark `[x]` if matched.
2. Add to README.md **功能特色 / Features** if new and noteworthy.

After adding DX tooling:
1. Add to README.md **技術棧 / Tech Stack**.
2. Document the `npm run` command in README.md **本地開發 / Development**.

After any architectural change (folders, files, routes):
1. Update both `CLAUDE.md` and `README.md` — they must stay in sync.

After any route change:
1. Update routing table in `CLAUDE.md`.
2. Update `sitemap.xml` in `public/` if it exists.
3. Update `navItems` in `Layout.tsx` if the route should appear in nav.

## Commit Conventions

Prefixes: `feat:`, `fix:`, `docs:`, `chore:`, `refactor:`, `style:`
Branches: `feat/<name>`, `fix/<name>`
Main branch: `main` (auto-deploys via GitHub Actions)

## Scripts

- `npm run dev` — dev server (port 3000)
- `npm run build` — production build
- `npm run sync` — fetch data from Google Sheets + download images
- `npm run lint` — check code (Biome)
- `npm run lint:fix` — auto-fix
- `npm run format` — format code
